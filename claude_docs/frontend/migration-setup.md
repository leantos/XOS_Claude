# Migration & Setup Guide

## Project Setup

### 1. Required Dependencies

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "jquery": "^3.6.0",
    "moment": "^2.29.4",
    "bootstrap": "^5.1.3",
    "fast-sort": "^3.2.0",
    "@microsoft/signalr": "^8.0.7",
    "@fortawesome/fontawesome-svg-core": "^6.1.1",
    "@fortawesome/free-solid-svg-icons": "^6.1.1",
    "@fortawesome/react-fontawesome": "^0.2.0",
    "crypto-js": "^4.2.0",
    "date-fns": "^4.1.0",
    "sass": "^1.69.7"
  }
}
```

### 2. Install Dependencies

```bash
npm install react react-dom jquery moment bootstrap fast-sort
npm install @microsoft/signalr @fortawesome/fontawesome-svg-core
npm install @fortawesome/free-solid-svg-icons @fortawesome/react-fontawesome
npm install crypto-js date-fns sass
```

### 3. Project Structure

```
your-project/
├── public/
│   └── index.html
├── src/
│   ├── xos-components/          # Copy entire folder from CVS project
│   │   ├── Core/
│   │   ├── Utils/
│   │   ├── XOSTextbox/
│   │   ├── XOSSelect/
│   │   ├── XOSGrid/
│   │   └── ... (all components)
│   ├── scss/                    # Copy entire folder from CVS project
│   │   ├── theme.scss           # Main SCSS entry point
│   │   ├── mixins/
│   │   ├── _base-layout.scss
│   │   ├── _xoscontrols.scss
│   │   └── ... (all SCSS files)
│   ├── components/
│   │   ├── Common/              # Shared components
│   │   │   ├── Main/            # Main container
│   │   │   ├── Header/
│   │   │   ├── Footer/
│   │   │   └── Login/
│   │   ├── General/             # Master/maintenance modules
│   │   │   ├── CustomerMaster/
│   │   │   └── ProductMaster/
│   │   ├── Transaction/         # Transaction modules
│   │   │   ├── SalesOrder/
│   │   │   └── PurchaseOrder/
│   │   └── Reports/            # Report modules
│   │       ├── SalesReport/
│   │       └── InventoryReport/
│   ├── assets/
│   │   ├── css/                 # Compiled CSS from SCSS
│   │   │   └── theme.css        # Generated by sass compiler
│   │   └── images/
│   ├── App.js
│   └── index.js
├── package.json
└── README.md
```

## Migration Steps

### Step 1: Copy XOS Components Framework

1. Copy the entire `xos-components` folder from the CVS project
2. Place it in your `src` folder
3. Verify all subfolders are included:
   - Core (API, Session, Crypto)
   - Utils (Utilities, LINQ extensions)
   - All UI components
   - CSS files

### Step 1.5: Copy SCSS Styling System

**Important:** The XOS framework requires its SCSS styling system for proper theming and component styling.

1. Copy the entire `scss` folder from `CVS.WebApi/UIPages/src/scss/`
2. Place it in your `src` folder
3. Follow the setup in **[xos-styling-integration.md](./xos-styling-integration.md)** for:
   - SCSS compilation setup
   - Build scripts configuration
   - Theme customization
   - Troubleshooting styling issues

### Step 2: Setup Bootstrap and Styles

```javascript
// In index.js or App.js
import 'bootstrap/dist/css/bootstrap.min.css';
import './assets/css/theme.css';  // Compiled from SCSS
import './xos-components/index.css';
import './xos-components/sticky-table.css';
```

**Note:** See [xos-styling-integration.md](./xos-styling-integration.md) for complete SCSS setup and theming guide.

### Step 3: Configure API Base URL

```javascript
// Create src/config.js
export const Config = {
    API_BASE_URL: process.env.REACT_APP_API_URL || 'http://localhost:5000/api/',
    TIMEOUT: 30000,
    DATE_FORMAT: 'DD/MM/YYYY',
    TIME_FORMAT: 'HH:mm',
    DATETIME_FORMAT: 'DD/MM/YYYY HH:mm'
};
```

### Step 4: Setup Main Application

```javascript
// App.js
import React from 'react';
import Main from './components/Common/Main';
import { ApiManager } from './xos-components/Core';

class App extends React.Component {
    componentDidMount() {
        // Initialize API Manager
        ApiManager.init({
            baseURL: Config.API_BASE_URL,
            timeout: Config.TIMEOUT
        });
    }
    
    render() {
        return <Main />;
    }
}

export default App;
```

### Step 5: Create Main Component

```javascript
// components/Common/Main/index.jsx
import React from 'react';
import * as cntrl from '../../../xos-components';
import MainVM from './MainVM';

export default class Main extends cntrl.XOSComponent {
    constructor(props) {
        super(props, new MainVM(props));
        this.inputRef = { Tab: null };
    }
    
    onLoad = () => {
        this.VM?.loadingInit();
    }
    
    addModuleTab = (moduleConfig) => {
        if (this.inputRef.Tab) {
            const tabs = [{
                title: moduleConfig.title,
                key: moduleConfig.key,
                url: moduleConfig.url,
                destroyOnHide: true,
                isClosable: true,
                data: moduleConfig.data || {}
            }];
            this.inputRef.Tab.addTab(tabs);
        }
    }
    
    render() {
        const model = this.VM?.Data;
        return (
            <cntrl.XOSControl 
                loading={model.ShowLoading}
                hideTitleBar={true}
                showBorder={false}
                context={this.props.context}
            >
                <div className="main-container">
                    <cntrl.XOSTab 
                        orientation="top"
                        context={this.attr}
                        ref={(el) => this.inputRef.Tab = el}
                    />
                </div>
            </cntrl.XOSControl>
        );
    }
}
```

## Renaming Conventions

### Module Naming
```
CVS Project → Your Project
CVSM001 → YPM001 (Your Project Master 001)
CVST001 → YPT001 (Your Project Transaction 001)
CVSR001 → YPR001 (Your Project Report 001)

Or use descriptive names:
CVSM001 → CustomerMaster
CVST005 → SalesOrder
CVSR010 → SalesReport
```

### Update References

1. **Folder Names:**
   ```
   components/General/CVSM001 → components/General/CustomerMaster
   ```

2. **Class Names:**
   ```javascript
   export default class CVSM001 → export default class CustomerMaster
   export default class CVSM001VM → export default class CustomerMasterVM
   ```

3. **Navigation URLs:**
   ```javascript
   url: 'General/CVSM001' → url: 'General/CustomerMaster'
   ```

## Backend API Configuration

### Expected API Response Format

```javascript
// Success Response
{
    "Success": true,
    "Data": { /* response data */ },
    "Message": "Operation successful"
}

// Error Response
{
    "Success": false,
    "Data": null,
    "Message": "Error message",
    "Errors": ["Field1 is required", "Field2 is invalid"]
}

// Grid Response
{
    "Items": [...],
    "Page": 1,
    "PageSize": 20,
    "TotalPage": 5,
    "TotalCount": 100
}
```

### API Endpoint Structure

```
GET    /api/Customer/GetInitialData    - Load dropdowns, config
GET    /api/Customer/GetGridData       - Grid with pagination
GET    /api/Customer/Get/{id}          - Get single record
POST   /api/Customer/Save              - Create/Update
DELETE /api/Customer/Delete/{id}       - Delete record
POST   /api/Customer/Search            - Search with criteria
```

## Environment Configuration

### Development (.env.development)
```
REACT_APP_API_URL=http://localhost:5000/api/
REACT_APP_ENV=development
REACT_APP_VERSION=1.0.0
```

### Production (.env.production)
```
REACT_APP_API_URL=https://api.yourapp.com/api/
REACT_APP_ENV=production
REACT_APP_VERSION=1.0.0
```

## Common Migration Issues

### Issue 1: jQuery Not Found
**Solution:** Ensure jQuery is imported globally
```javascript
// In index.js
import $ from 'jquery';
window.jQuery = window.$ = $;
```

### Issue 2: LINQ Extensions Not Working
**Solution:** Import array extensions
```javascript
// In App.js or index.js
import './xos-components/Utils/xos.linq';
```

### Issue 3: API Calls Failing
**Solution:** Check CORS and API format
```javascript
// Backend CORS configuration
app.UseCors(builder => builder
    .AllowAnyOrigin()
    .AllowAnyMethod()
    .AllowAnyHeader());
```

### Issue 4: State Not Persisting
**Solution:** Ensure proper context setup
```javascript
// Component must receive context prop
<YourComponent context={this.props.context} />
```

### Issue 5: Styles Not Applied
**Solution:** Import Bootstrap and XOS styles
```javascript
import 'bootstrap/dist/css/bootstrap.min.css';
import './xos-components/index.css';
```

## Testing Checklist

### Basic Functionality
- [ ] Application loads without errors
- [ ] Main tab container renders
- [ ] Can open new tabs
- [ ] Can close tabs
- [ ] Navigation between tabs works

### Component Testing
- [ ] XOSTextbox accepts input
- [ ] XOSSelect shows dropdown
- [ ] XOSGrid displays data
- [ ] XOSDatepicker opens calendar
- [ ] Form validation works

### State Management
- [ ] State persists on tab switch
- [ ] updateUI() triggers re-render
- [ ] ViewModel data binding works
- [ ] Focus management works

### API Integration
- [ ] API calls reach backend
- [ ] Response data displays
- [ ] Error handling works
- [ ] Loading states show

### Navigation
- [ ] showWindow() opens modal
- [ ] addTab() creates new tab
- [ ] close() returns data
- [ ] Message boxes display

## Troubleshooting Guide

### Debug Mode
```javascript
// Enable debug logging
window.XOS_DEBUG = true;

// In Utils.js
if (window.XOS_DEBUG) {
    console.log('API Call:', url, data);
    console.log('Response:', response);
}
```

### Check Component Registration
```javascript
componentDidMount() {
    console.log('VM:', this.VM);
    console.log('State:', this.VM?.Data);
    console.log('Context:', this.props.context);
}
```

### Verify State Updates
```javascript
updateUI() {
    console.log('UpdateUI called', this.Data);
    super.updateUI();
}
```

### Monitor API Calls
```javascript
// Browser DevTools
Network Tab → Filter by XHR → Check request/response
```

## Performance Optimization

### 1. Lazy Loading Modules
```javascript
const CustomerMaster = React.lazy(() => 
    import('./components/General/CustomerMaster')
);
```

### 2. Optimize Grid Rendering
```javascript
// Use virtualization for large datasets
<XOSGrid
    virtualization={true}
    rowHeight={30}
    visibleRows={20}
/>
```

### 3. Debounce Search
```javascript
// Already built into XOSSelect
<XOSSelect
    asyncSearch={searchFunction}
    delay={300}  // Debounce delay
    minChar={2}  // Minimum characters
/>
```

### 4. Memory Management
```javascript
// Always implement cleanup
onClosing() {
    // Clear timers
    if (this.timer) clearInterval(this.timer);
    
    // Clear large data
    this.VM.Data.LargeDataset = null;
    
    return true;
}
```

## Next Steps

1. **Test Core Framework** - Ensure XOS components work
2. **Create First Module** - Start with a simple master screen
3. **Setup Authentication** - Integrate login flow
4. **Configure Routes** - Setup module navigation
5. **Style Customization** - Apply your branding
6. **Deploy** - Build and deploy application