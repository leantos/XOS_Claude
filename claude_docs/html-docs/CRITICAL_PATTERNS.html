<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRITICAL_PATTERNS - XOS Framework</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-dark.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body data-theme="dark">
    <div class="container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <h3><i class="bi bi-arrow-left"></i> Quick Links</h3>
            <ul>
                <li><a href="README.html"><i class="bi bi-house"></i> Documentation Hub</a></li>
                <li><a href="CRITICAL_PATTERNS.html"><i class="bi bi-exclamation-triangle"></i> Critical Patterns</a></li>
                <li><a href="MODULE-DEVELOPMENT-GUIDE.html"><i class="bi bi-book"></i> Module Guide</a></li>
                <li><a href="SETUP.html"><i class="bi bi-gear"></i> Setup Guide</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <p># ?? CRITICAL PATTERNS - MUST READ FIRST

<h2>?? This is NOT a Standard ASP.NET Core + React Application</h2>

Applications built with the <strong>custom XOS enterprise framework</strong> significantly modify standard patterns. Following standard React or ASP.NET Core patterns will cause errors.

<h2>?? XOS Component Implementation Checklist (100% ACCURACY)</h2>

<h3>? MUST DO - Complete this checklist for EVERY XOS component:</h3>

<div class="code-block"><pre><code>bash
# 1. Install Dependencies (ONE TIME)
cd CVS_Claude.WebApi/UIPages
npm install react-color fast-sort --save

# 2. Copy Theme CSS (ONE TIME)
cp D:\Projects\CVS_Claude\assets\css\theme.css D:\Projects\CVS_Claude\CVS_Claude.WebApi\UIPages\src\theme.css
</code></pre></div>

<div class="code-block"><pre><code>javascript
// 3. Import Pattern (EVERY COMPONENT)
import <em> as cntrl from '../../xos-components';  // ? CORRECT
// NOT: import { XOSComponent } from '../../xos-components/XOSComponent.js';  ?

// 4. Component Class (EVERY COMPONENT)
export class MyComponent extends cntrl.XOSComponent {  // ? CORRECT
    constructor(props) {
        super(props, new MyComponentVM(props));  // Pass VM to super
    }
}

// 5. ViewModel State Initialization (CRITICAL!)
export default class MyComponentVM extends VMBase {
    constructor(props) {
        super(props);
        this.init();
    }
    
    init() {
        // ?? CRITICAL: Get reference to Data, then set properties!
        const model = this.Data;     // Get reference to _____state
        model.userName = '';         // ? CORRECT - Set on reference
        // this.Data = { userName: '' };  // ? ERROR: Cannot set Data
    }
}

// 6. Event Handlers (EVERY XOS INPUT) - MEMORIZE THIS PATTERN!
handleInputChange = (e) => {
    if (this.VM) {
        const model = this.VM.Data;  // Step 1: Get reference to _____state
        model[e.name] = e.value;     // Step 2: Modify property (e.value NOT e.target.value!)
        this.VM.updateUI();           // Step 3: Trigger re-render (NEVER FORGET THIS!)
    }
}

// 7. XOSTextbox Usage (EVERY TEXT INPUT)
<cntrl.XOSTextbox
    name="userName"  // ?? CRITICAL: name prop for e.name in handler!
    value={this.VM.Data.userName || ''}
    onChange={this.handleInputChange}
    inputType={cntrl.XOSTextboxTypes.textbox}  // or .password
    mandatory={true}
/>

// 8. Buttons (EVERY BUTTON)
<button className="btn btn-primary">  // ? HTML button with Bootstrap
    <i className="fa fa-save"></i> Save  // ? fa NOT fas
</button>

// 8. Theme Import (App.js ONLY)
import './theme.css';  // ? In App.js after copying to src/
</code></pre></div>

<h3>? NEVER DO - These will break XOS components:</h3>

<div class="code-block"><pre><code>javascript
// ? WRONG imports
import { XOSComponent } from '../../xos-components/XOSComponent.js';
import '../../../assets/css/theme.css';  // Can't import outside src/

// ? WRONG event handling
handleChange(event) {
    this.VM.setValue(event.target.value);  // Won't work with XOSTextbox
}

// ? WRONG icon classes
<i className="fas fa-user"></i>  // Use 'fa' not 'fas'

// ? WRONG - Looking for XOSButton
<cntrl.XOSButton>  // Doesn't exist for UI
</code></pre></div>

<h2>?? Database Access Pattern (CRITICAL)</h2>

<h3>? CORRECT Pattern - MUST USE</h3>
<div class="code-block"><pre><code>csharp
await db.GetEntityDataListAsync<T>(query, params, (row) => {
    return new T {
        ID = row.GetValue<int>("id"),
        Name = row.GetValue<string>("name", "default")
    };
});
</code></pre></div>

<h3>? WRONG Pattern - Will Cause Runtime Errors</h3>
<div class="code-block"><pre><code>csharp
// DO NOT USE standard ADO.NET patterns
row["id"]  // WRONG
row.GetInt32(0)  // WRONG
</code></pre></div>

<h2>?? Frontend State Updates (CRITICAL)</h2>

<h3>? CORRECT Pattern - Manual Updates Required</h3>
<div class="code-block"><pre><code>javascript
// In ViewModel
onChange = (prop, val) => {
    this.Data.Input[prop] = val;  // Direct mutation
    this.updateUI();  // MANDATORY - UI won't update without this
}

// In Component
handleChange = () => {
    this.VM.Data.value = newValue;
    this.VM.updateUI();  // REQUIRED for UI to reflect changes
}
</code></pre></div>

<h3>? WRONG Pattern - UI Won't Update</h3>
<div class="code-block"><pre><code>javascript
// These patterns will NOT work
this.setState({ value: newValue });  // NO - XOS doesn't use setState for data
const [value, setValue] = useState();  // NO - No hooks in XOS components
this.Data.property = value;  // NO - Missing updateUI() call
</code></pre></div>

<h2>?? API Pattern - 95% POST Only</h2>

<h3>? CORRECT Pattern</h3>
<div class="code-block"><pre><code>csharp
[HttpPost("Save")]  // Always POST, even for reads
public async Task<DomainType> SaveAsync([FromBody] Input input)
{
    // Return domain type directly, not IActionResult
    return domainObject;
}

[HttpPost("GetList")]  // POST for getting data
public async Task<List<Item>> GetListAsync([FromBody] SearchParams params)
{
    return items;
}
</code></pre></div>

<h3>? WRONG Pattern</h3>
<div class="code-block"><pre><code>csharp
[HttpGet]  // NO - Use POST
[HttpPut]  // NO - Use POST
[HttpDelete]  // NO - Use POST
public IActionResult Get()  // NO - Return domain types directly
</code></pre></div>

<h2>?? jQuery Dependency (REQUIRED)</h2>

<h3>? jQuery is MANDATORY</h3>
<div class="code-block"><pre><code>javascript
// XOS requires jQuery throughout
$('body').addClass('overflow-hidden');
$('.modal').modal('show');
$(this.getRef('input')).val(value);
</code></pre></div>

<h3>? Cannot Remove jQuery</h3>
<ul><li>XOS framework depends on jQuery</li><li>Bootstrap components require jQuery</li><li>Many XOS utilities use jQuery internally</li></ul>

<h2>?? Transaction Pattern with SignalR</h2>

<h3>? CORRECT Complex Transaction Pattern</h3>
<div class="code-block"><pre><code>csharp
using (var dbService = this.GetDBService("CrystalDB", transOwner))
using (var tran = dbService.BeginTransaction())
{
    try
    {
        // Multiple database operations
        await SaveData(dbService);
        
        // Commit before SignalR
        tran.Commit();
        
        // SignalR notifications AFTER commit
        await HubContext.Clients.All.SendAsync("DataUpdated", data);
    }
    catch
    {
        tran.Rollback();
        throw;
    }
}
</code></pre></div>

<h2>?? Mixed API Call Patterns</h2>

<h3>Primary Pattern - Utils.ajax</h3>
<div class="code-block"><pre><code>javascript
// Most common pattern in codebase
Utils.ajax({ 
    url: 'Site/Save',  // Relative URL
    data: this.Data.Input 
}, (resp) => {
    // Handle response
});
</code></pre></div>

<h3>Secondary Pattern - ApiManager</h3>
<div class="code-block"><pre><code>javascript
// Used in some components
ApiManager.post('/api/Site/Save', this.Data.Input)
    .then(resp => {
        // Handle response
    });
</code></pre></div>

<h2>?? Multi-Tenant Database Configuration</h2>

<h3>Connection String Pattern</h3>
<div class="code-block"><pre><code>json
{
  "CrystalDB": {
    "ConnectionString": "Host=localhost;Database=crystaldb;",
    "Keys": ["1", "MG"]  // Client routing keys
  },
  "CrystalDB2": {
    "ConnectionString": "Host=localhost;Database=crystaldb2;",
    "Keys": ["2", "WB"]  // Different client keys
  }
}
</code></pre></div>

<h2>?? Bootstrap + XOS Hybrid</h2>

<h3>Mixed Component Usage</h3>
<div class="code-block"><pre><code>jsx
// XOS components
<XOSButton />
<XOSGrid />

// Bootstrap classes (required)
<div className="modal-dialog modal-xl">
<button className="btn btn-primary">
<div className="col-md-6">
</code></pre></div>

<h2>?? File Upload Pattern</h2>

<h3>Mixed JSON + Files</h3>
<div class="code-block"><pre><code>csharp
[HttpPost("Upload")]
public async Task<Result> UploadAsync(
    [FromBody] JsonData data,  // JSON from body
    List<IFormFile> files)      // Files from form
{
    // Handle both JSON and files
}
</code></pre></div>

<h2>? Quick Validation Checklist</h2>

Before running your code, verify:

<ul><li>? Database reads use <code>row.GetValue<T>("column")</code></li><li>? All state changes call <code>updateUI()</code></li><li>? API endpoints use POST</li><li>? Controllers return domain types directly</li><li>? jQuery is included and available</li><li>? Transactions commit before SignalR calls</li><li>? Frontend uses Utils.ajax for API calls</li><li>? Bootstrap classes are used for layout</li></ul>

<h2>?? Essential Reading Order</h2>

<ul><li><strong>This Document</strong> (CRITICAL_PATTERNS.html)</li><li><strong>XOS Framework Guide</strong> (frontend/xos-framework.html)</li><li><strong>Backend Blueprint</strong> (backend/backend-blueprint.html)</li><li><strong>Database Schema</strong> (database/database-schema.html)</li></ul>

<h2>?? Common Pitfalls to Avoid</h2>

<ul><li><strong>Don't use React hooks</strong> - XOS components don't support them</li><li><strong>Don't use Entity Framework</strong> - Use XOS data framework</li><li><strong>Don't create RESTful APIs</strong> - Use POST pattern</li><li><strong>Don't expect automatic UI updates</strong> - Call updateUI()</li><li><strong>Don't remove jQuery</strong> - It's required everywhere</li><li><strong>Don't use IActionResult</strong> - Return domain types</li><li><strong>Don't use standard React state</strong> - Use VM.Data pattern</li></ul>

---

<h2>?? Quick Navigation</h2>
<ul><li><a href="./README.html">? Back to claude_docs</a> - Main documentation hub</li><li><a href="./MODULE-DEVELOPMENT-GUIDE.html">Module Development Guide</a> - Complete workflows</li><li><a href="./CLAUDE-PROMPT-QUICK-REFERENCE.html">Quick Reference Prompts</a> - Copy-paste prompts</li><li><a href="./frontend/xos-input-handling-fix.html">XOS Input Fix</a> - Fix typing issues</li><li><a href="./backend/backend-blueprint.html">Backend Blueprint</a> - API patterns</li><li><a href="./SETUP.html">Setup Guide</a> - Environment setup</li></ul>

</em>This document contains the most critical patterns that differ from standard development. Master these before proceeding with any implementation.*</p>
            
            <div class="footer">
                <p><em>Auto-generated from Markdown</em><br>
                <em>Part of XOS Framework Documentation</em></p>
            </div>
        </main>
    </div>

    <script>
        // Copy code functionality
        function copyCode(button, codeId) {
            const codeElement = document.getElementById(codeId);
            const text = codeElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }

        // Collapsible sections
        function toggleCollapsible(header) {
            const collapsible = header.parentElement;
            collapsible.classList.toggle('expanded');
        }
    </script>
</body>
</html>
